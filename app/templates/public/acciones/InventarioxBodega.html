{% extends 'public/base_inventario.html' %}
{% block title %}Reportar Inventario{% endblock %}

{% block body %}
<div class="container">
  <style>
    .input-small {
      width: 80px;
      font-size: 0.85rem;
    }

    .select-small {
      width: 120px;
    }

    .product-column {
      width: 300px;
    }

    @media (max-width: 576px) {
      .input-small {
        width: 100%;
      }

      .select-small {
        width: 100%;
      }

      .product-column {
        width: auto;
      }
    }
    
    .inventory-header {
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .table-container {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0,0,0,0.05);
    }
  </style>
  
  <div class="row mb-4">
    <div class="col-12">
      <div class="inventory-header">
        <h3 class="text-center mb-3">Registro de Inventario</h3>
        <div class="row text-center">
          <div class="col-md-4 mb-2 mb-md-0">
            <span class="badge bg-primary p-2"><i class="bi bi-person me-1"></i> Usuario: {{ Usuario }}</span>
          </div>
          <div class="col-md-4 mb-2 mb-md-0">
            <span class="badge bg-info text-dark p-2"><i class="bi bi-box me-1"></i> Bodega: 
              {% if Bodega == '2' %}Preparación{% elif Bodega == '4' %}Bodega{% else %}{{ Bodega }}{% endif %}
            </span>
          </div>
          <div class="col-md-4">
            <span class="badge bg-secondary p-2"><i class="bi bi-calendar-date me-1"></i> Fecha: {{ FechaInv }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% if miData %}
  <form method="POST" action="{{ url_for('guardar_inventario') }}">

    <!-- Campos ocultos -->
    <input type="hidden" name="Usuario" value="{{ Usuario }}">
    <input type="hidden" name="Bodega" value="{{ Bodega }}">
    <input type="hidden" name="FechaInv" value="{{ FechaInv }}">
    
    <div class="row mb-3">
      <div class="col-12">
        <div class="input-group">
          <span class="input-group-text bg-primary text-white"><i class="bi bi-search"></i></span>
          <input type="text" id="searchProduct" class="form-control" placeholder="Buscar producto...">
        </div>
      </div>
    </div>

    <div class="table-container">
      <div class="table-responsive">
        <table class="table table-striped table-hover mb-0">
          <thead class="table-dark">
            <tr class="text-center">
              <th scope="col" class="product-column">Producto</th>
              <th scope="col">Completos</th>
              <th scope="col">Unidades</th>
            </tr>
          </thead>
          <tbody>
            {% for carro in miData %}
            <tr id="Registro_{{ carro.CodMP }}" class="product-row">
              <td class="align-middle">{{ carro.MP }}</td>

              <!-- Campo Paquetes con placeholder UdeM -->
              <td class="text-center">
                <div class="input-group input-group-sm">
                  <input type="number"
                         class="form-control input-small"
                         name="NroPaquetes_{{ carro.CodMP }}"
                         placeholder="{{ carro.UdeM }}"
                         {% if carro.TpoInventario == 0 %} value="0" readonly {% else %} min="0" required {% endif %}>
                </div>
              </td>

              <!-- Campo Uds -->
              {% if carro.TpoInventario == 0 or carro.TpoInventario == 1 %}
              <td class="text-center">
                <div class="input-group input-group-sm">
                  <input type="number"
                         class="form-control input-small"
                         name="NroUnidades_{{ carro.CodMP }}"
                         min="0"
                         required />
                </div>
              </td>

              {% elif carro.TpoInventario == 2 %}
              <td class="text-center">
                <select class="form-select form-select-sm select-small" name="NroUnidades_{{ carro.CodMP }}" required>
                  <option value="">Seleccione</option>
                  <option value="0.75">Casi Completo</option>
                  <option value="0.50">Medio</option>
                  <option value="0.25">Un Cuarto</option>
                  <option value="0">Nada</option>
                </select>
              </td>

              {% elif carro.TpoInventario == 3 %}
              <td class="text-center">
                <select class="form-select form-select-sm select-small" name="NroUnidades_{{ carro.CodMP }}" required>
                  <option value="">Seleccione</option>
                  <option value="0">Nada</option>
                  <option value="350">1 Tarro</option>
                  <option value="700">2 Tarros</option>
                  <option value="1050">3 Tarros</option>
                  <option value="1400">4 Tarros</option>
                  <option value="1750">5 Tarros</option>
                  <option value="2100">6 Tarros</option>
                  <option value="2450">7 Tarros</option>
                  <option value="2800">8 Tarros</option>
                  <option value="3150">9 Tarros</option>
                  <option value="3500">10 Tarros</option>
                </select>
              </td>
              {% endif %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="row mt-4 mb-3">
      <div class="col-12 text-center">
        <button type="submit" class="btn btn-primary btn-lg">
          <i class="bi bi-save me-2"></i> Guardar Inventario
        </button>
      </div>
    </div>
  </form>

  {% else %}
  <div class="alert alert-info shadow-sm">
    <div class="row mb-3">
      <div class="col-12 text-center">
        <i class="bi bi-exclamation-circle fs-1"></i>
        <h4 class="mt-3">No hay productos asignados a la bodega</h4>
        <p>No se encontraron productos para esta bodega.</p>
        <a href="/" class="btn btn-primary mt-2">
          <i class="bi bi-arrow-left me-2"></i>Volver al inicio
        </a>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<script>
  // Función de búsqueda de productos
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchProduct');
    if (searchInput) {
      searchInput.addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('.product-row');
        
        rows.forEach(row => {
          const productName = row.querySelector('td:first-child').textContent.toLowerCase();
          if (productName.includes(searchTerm)) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      });
    }
  });
</script>
{% endblock %}
